var Utility=function(){this.setup=function(){try{this.canvas=document.querySelector('canvas');this.context=this.canvas.getContext('2d');this.screen={width:window.innerWidth,height:window.innerHeight};document.querySelector('body').style.margin="0px";document.querySelector('body').style.padding="0px";this.canvas.height=this.screen.height;this.canvas.width=this.screen.width;return{canvas:this.canvas,context:this.context,width:this.screen.width,height:this.screen.height}}
catch(e){console.log("cannot setup screen.");console.log(e)}}
this.randomIntFromRange=function(min,max){return Math.floor(Math.random()*(max-min+1)+min)}
this.distance=function(x1,y1,x2,y2){var xDist=x2-x1;var yDist=y2-y1;return Math.sqrt(Math.pow(xDist,2)+Math.pow(yDist,2))}
this.hits=function(a,b){var x1=a.position.x;var y1=a.position.y;var x2=b.position.x;var y2=b.position.y;var dist=this.distance(x1,y1,x2,y2);var sum_radius=a.radius+b.radius;return(dist-sum_radius)<0}}
var util=new Utility()
function Ship(x,y){this.position={x:x,y:y}
this.radius=7;this.color="#d5d5d5";this.shipImage=document.getElementById('ship');this.flame={sprite:document.getElementById('flame'),sx:0,sy:0,sWidth:242,sHeight:258};this.currentFrame;this.draw=function(){c.drawImage(this.shipImage,this.position.x-30,this.position.y-30,60,60);c.drawImage(this.flame.sprite,this.flame.sx,this.flame.sy,this.flame.sWidth,this.flame.sHeight,this.position.x-15,this.position.y+30,30,30)}
this.update=function(){if(total_frames%8==0){this.currentFrame=++total_frames%3;this.flame.sx=this.currentFrame*this.flame.sWidth}
this.draw()}
this.move=function(data,type){if(!(this.position.x<0||this.position.x>width)){if(type){this.position.x=event.touches[0].clientX}
else{this.position.x=event.clientX}}}}
function Bullet(x){this.position={x:x,y:height-130}
this.radius=3;this.dy=5;this.color="#ff0";this.draw=function(){c.beginPath();c.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2,!1);c.fillStyle=this.color;c.fill();c.closePath()}
this.update=function(){this.position.y-=this.dy;this.draw()}}
function Enemy(position,radius){this.position={x:position.x,y:position.y}
this.radius=radius/2;this.dy=0.1*this.radius;this.dim={width:this.radius*2,height:this.radius*2}
this.color="#d5d5d5";this.images=[document.getElementById('ast_1'),document.getElementById('ast_2'),document.getElementById('ast_3')];this.asteroidImage=this.images[util.randomIntFromRange(0,2)];this.draw=function(){c.drawImage(this.asteroidImage,this.position.x-(this.radius),this.position.y-(this.radius),this.dim.width,this.dim.height)}
this.update=function(){this.position.y+=this.dy;this.draw()}
this.reset=function(){this.position.x=util.randomIntFromRange(0+this.radius,width-this.radius);this.position.y=util.randomIntFromRange(-(height/2),0);this.asteroidImage=this.images[util.randomIntFromRange(0,2)];this.update()}}
function Star(){this.radius=util.randomIntFromRange(1,2);this.dr=1;this.dy=this.radius/5;this.position={x:util.randomIntFromRange(0,width),y:util.randomIntFromRange(0,height)}
this.draw=function(){c.beginPath();c.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2,!1);c.fillStyle="white";c.fill();c.closePath()}
this.update=function(){if(this.radius>=2||this.radius<=1){this.dr=-(this.dr)}
this.radius+=(this.dr/50);this.position.y+=this.dy;if(this.position.y>height){this.position.x=util.randomIntFromRange(0,width);this.position.y=-10}
this.draw()}}var Game=function(){this.over=!1;this.bullets=[];this.enemys=[];this.stars=[];this.ship=undefined;this.point=0;this.start=function(){if(!this.over){this.reset();info()
animate();document.querySelector('.btn-set').style.display='none';canvas.style.cursor="none"}}
this.stop=function(){this.enemys.forEach(function(enemy){enemy.dy=0});this.bullets.forEach(function(bullet){bullet.dy=0});this.stars.forEach(function(star){star.dy=0});document.getElementById('point').innerHTML=this.point+" game over"}
this.reset=function(){this.enemys=[];this.bullets=[];this.stars=[];this.ship=undefined;this.point=0;this.over=!1;document.getElementById('point').innerHTML=0;init()}
this.addPoint=function(size){(size<=25?this.point+=2:this.point+=5);document.getElementById('point').innerHTML=this.point}}var setup=util.setup();var width=setup.width;var height=setup.height;var canvas=setup.canvas;var c=setup.context;var total_frames=0;document.querySelector("canvas").addEventListener('touchmove',function(event){try{game.ship.move(event,!0)}
catch(e){}});document.querySelector("canvas").addEventListener('mousemove',function(event){try{game.ship.move(event,!1)}
catch(e){}});document.querySelector("canvas").addEventListener('click',function(event){if(game.over){game.reset()}
else{try{game.bullets.push(new Bullet(game.ship.position.x))}
catch(e){}}});var game=new Game();function init(){game.bullets=[];game.enemys=[];game.stars=[]
for(var i=0;i<30;i++){game.stars.push(new Star(position))}
for(var i=0;i<5;i++){var radius=util.randomIntFromRange(20,70);var position={x:util.randomIntFromRange(0+radius,width-radius),y:util.randomIntFromRange(-(height),0)}
game.enemys.push(new Enemy(position,radius))}
game.ship=new Ship((width/2),(height-100))}
function animate(){requestAnimationFrame(animate);c.clearRect(0,0,width,height);total_frames+=1;game.stars.forEach((star)=>{star.update()});game.bullets.forEach(function(bullet,i){if(bullet.position.y>0){game.enemys.forEach(function(enemy){if(util.hits(bullet,enemy)){game.addPoint(enemy.radius);enemy.reset();game.bullets.splice(i,1)}});bullet.update()}
else{game.bullets.splice(i,1)}});game.ship.update();game.enemys.forEach(function(enemy){if(enemy.position.y>height+enemy.radius){enemy.reset()}
else if(util.hits(enemy,game.ship)){game.over=!0;game.stop();enemy.update()}
else{enemy.update()}})}
var last_fps=0;function info(){setInterval(function(){document.getElementById('fps').innerHTML=total_frames-last_fps;last_fps=total_frames},1000)}
