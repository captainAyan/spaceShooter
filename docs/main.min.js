var Utility=function(){this.setup=function(){try{this.canvas=document.querySelector('canvas');this.context=this.canvas.getContext('2d');this.screen={width:window.innerWidth,height:window.innerHeight};document.querySelector('body').style.margin="0px";document.querySelector('body').style.padding="0px";this.canvas.height=this.screen.height;this.canvas.width=this.screen.width;this.canvas.style.background="#000";return{context:this.context,width:this.screen.width,height:this.screen.height}}
catch(e){console.log("cannot setup screen.");console.log(e)}}
this.randomIntFromRange=function(min,max){return Math.floor(Math.random()*(max-min+1)+min)}
this.distance=function(x1,y1,x2,y2){var xDist=x2-x1;var yDist=y2-y1;return Math.sqrt(Math.pow(xDist,2)+Math.pow(yDist,2))}
this.hits=function(a,b){var x1=a.position.x;var y1=a.position.y;var x2=b.position.x;var y2=b.position.y;var dist=this.distance(x1,y1,x2,y2);var sum_radius=a.radius+b.radius;if((dist-sum_radius)<0){return!0}
else{return!1}}}
let util=new Utility()
function Ship(x,y,radius){this.position={x:x,y:y}
this.radius=radius;this.color="#d5d5d5";this.draw=function(){c.beginPath();c.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2,!1);c.moveTo(this.position.x,this.position.y);c.lineTo(this.position.x,this.position.y-(this.radius*2));c.lineWidth=5;c.strokeStyle=this.color;c.stroke();c.closePath()}
this.update=function(){this.draw()}
this.move=function(){if(!(this.position.x<0||this.position.x>width)){this.position.x=event.touches[0].clientX}}}
function Bullet(x){this.position={x:x,y:height-100}
this.radius=3;this.dy=5;this.color="#f00";this.draw=function(){c.beginPath();c.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2,!1);c.strokeStyle=this.color;c.stroke();c.closePath()}
this.update=function(){this.position.y-=this.dy;this.draw()}}
function Enemy(position,radius){this.position={x:position.x,y:position.y}
this.dy=(radius*1.3)/10;this.color="rgba(255,255,255,0.7)";this.radius=radius;this.draw=function(){c.beginPath();c.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2,!1);c.fillStyle=this.color;c.fill();c.closePath()}
this.update=function(){this.position.y+=this.dy;this.draw()}
this.reset=function(){this.position.x=util.randomIntFromRange(0+radius,width-radius);this.position.y=util.randomIntFromRange(-(height/2),0);this.radius=util.randomIntFromRange(5,30);this.dy=(this.radius*1.3)/10;this.update()}}
var Game=function(){this.over=!1;this.bullets=[];this.enemys=[];this.ship=undefined;this.point=0;this.start=function(){if(!this.over){this.reset();info()
animate();document.querySelector('.btn-set').style.display='none'}}
this.stop=function(){this.enemys.forEach(function(enemy){enemy.dy=0});this.bullets.forEach(function(bullet){bullet.dy=0});document.getElementById('point').innerHTML=this.point+" game over"}
this.reset=function(){enemys=undefined;bullets=[];ship=[];this.point=0;this.over=!1;document.getElementById('point').innerHTML=0;init()}
this.addPoint=function(size){(size<=15?this.point+=2:this.point+=5);document.getElementById('point').innerHTML=this.point}}
var setup=util.setup();var width=setup.width;var height=setup.height;var c=setup.context;document.querySelector(".btn").addEventListener('click',function(){game.start()});document.querySelector("canvas").addEventListener('touchmove',function(event){try{game.ship.move(event)}
catch(e){}});document.querySelector("canvas").addEventListener('click',function(event){if(game.over){game.reset()}
else{try{game.bullets.push(new Bullet(game.ship.position.x))}
catch(e){}}});var game=new Game();function init(){game.ship=new Ship((width/2),(height-100),20);game.bullets=[];game.enemys=[];for(var i=1;i<10;i++){var radius=util.randomIntFromRange(5,30);var position={x:util.randomIntFromRange(0+radius,width-radius),y:util.randomIntFromRange(-(height/2),0)}
game.enemys.push(new Enemy(position,radius))}}
var total_frames=0;function animate(){requestAnimationFrame(animate);c.clearRect(0,0,width,height);total_frames+=1;game.ship.update();game.bullets.forEach(function(bullet,i){if(bullet.position.y>0){game.enemys.forEach(function(enemy){if(util.hits(bullet,enemy)){game.addPoint(enemy.radius);enemy.reset();game.bullets.splice(i,1)}});bullet.update()}
else{game.bullets.splice(i,1)}});game.enemys.forEach(function(enemy){if(enemy.position.y>height+enemy.radius){enemy.reset()}
else if(util.hits(enemy,game.ship)){game.over=!0;game.stop();enemy.update()}
else{enemy.update()}})}
function info(){setInterval(function(){document.getElementById('fps').innerHTML=total_frames;total_frames=0},1000)}
